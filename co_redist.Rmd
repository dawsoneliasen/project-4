```{r}
library(redist)  # redistricting sampling
library(sf)  # shapefile handling
library(spdep)  # shapefile calculations
library(tidyverse)

set.seed(400)
```

```{r}
# read CO shapefile
co_shp <- read_sf(dsn='co_precincts', layer='co_precincts')
```

```{r}
# make a quick plot
ggplot(co_shp, aes(fill=CD116FP)) +
    geom_sf(size=0) +
    scale_fill_brewer(palette='Set2')
```

```{r}
# sort CO data by voter district
co_shp$CD116FP <- as.integer(co_shp$CD116FP)
co_shp <- co_shp %>% arrange(CD116FP)
# calculate CO precinct adjacency list
adjlist <- poly2nb(pl=co_shp, queen=FALSE)

# run MCMC samples of redistricting
m <- 100  # ?
# should we use mcmc, or mcmc.mpi?
mcmc_out <- redist.mcmc(
    adjobj=adjlist,
    popvec=co_shp$TOTPOP, 
    initcds=co_shp$CD116FP,
    nsims=m,
    savename='co_redist.mcmc'
)
```

```{r}
co_shp$CD116FP <- mcmc_out$partitions[,1]
co_shp$CD116FP <- as.factor(co_shp$CD116FP)

ggplot(co_shp, aes(fill=CD116FP)) +
    geom_sf(size=0) +
    scale_fill_brewer(palette='Set2')
```

